import polars as pl
import polars_quant as plqt

df = {
    'date': [
        '2023-01-01', '2023-01-02', '2023-01-03', '2023-01-04', '2023-01-05',
        '2023-01-08', '2023-01-09', '2023-01-10', '2023-01-11', '2023-01-12',
        '2023-01-15', '2023-01-16', '2023-01-17', '2023-01-18', '2023-01-19',
        '2023-01-22', '2023-01-23', '2023-01-24', '2023-01-25', '2023-01-26'
    ],
    'open': [
        100.0, 104.5, 106.7, 107.2, 108.0,
        109.5, 110.2, 112.0, 111.5, 113.0,
        112.8, 114.5, 115.0, 116.2, 117.0,
        116.5, 118.0, 119.5, 120.0, 121.2
    ],
    'high': [
        105.0, 107.8, 108.2, 108.5, 109.8,
        111.0, 112.5, 113.2, 112.8, 114.5,
        115.0, 116.0, 116.5, 117.8, 118.5,
        118.0, 119.5, 120.8, 121.5, 122.0
    ],
    'low': [
        99.5, 103.9, 105.1, 106.0, 107.2,
        108.5, 109.0, 110.5, 110.0, 111.5,
        111.0, 113.0, 114.0, 115.0, 116.0,
        115.5, 117.0, 118.5, 119.0, 120.0
    ],
    'close': [
        104.2, 106.5, 107.0, 108.2, 109.0,
        110.5, 111.8, 112.5, 111.9, 113.8,
        114.2, 115.5, 116.0, 117.5, 118.0,
        117.5, 119.0, 120.5, 121.0, 121.8
    ],
    'volume': [
        1000000, 1200000, 950000, 1100000, 1050000,
        1150000, 1250000, 1300000, 950000, 1100000,
        1050000, 1200000, 1150000, 1300000, 1250000,
        1100000, 1350000, 1400000, 1300000, 1450000
    ]
}

df = pl.DataFrame(df)[["date", "close"]]
entries_pl = df.with_columns((pl.col("close") > pl.col("close").shift(1)))
exits_pl = df.with_columns((pl.col("close") < pl.col("close").shift(1)))
bt = plqt.Backtrade.run(df, entries_pl, exits_pl).summary()


